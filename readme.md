## ws actions:

Все события описываются в следующем формате:

```typescript
{
  type: string;
  payload: Object;
}
```

Типы событий, инициируемых фронтом, начинаются с перфикса `INIT_`
Типы событий, инициируемых беком, начинаются с префикса `SET_`

****

**`INIT_LOGIN`**
```typescript
{
  nickname: string;
}
```

**`SET_LOGIN`**
```typescript
{
  id: number;
  isAdmin: boolean; // админский комп определен однозначно. Думаю, запускать приложение нужно с флагом
  success: boolean;
}
```

**`INIT_COM`**
```typescript
{
  com: number;
}
```

**`SET_COM`**
```typescript
{
  com: number;
  success: boolean; // если false, значит не удается подключиться к этому порту
}
```

**`SET_USER`**
> broadcast
```typescript
{
  id: number;
  nickname: string;
}
```

**`INIT_MESSAGE`**
```typescript
{
  to: number | null; // если null, то broadcast
  text: string;
}
```

**`SET_MESSAGE`**
```typescript
{
  from: number;
  to: number | null; // если null, то broadcast
  text: string;
}
```

**`INIT_SETTINGS`**
> Мапа, пока не знаю, что там надо
```typescript
{
  [key: string]: string | number;
}
```

**`SET_SETTINGS`**
> Происходи не только при INIT_SETTINGS но и просто при подключении. Оправляются дефолтные настройки или измененные настройки. В общем, текущие.
```typescript
{
  success: boolean;
  data: {
    [key: string]: string | number;
  }
}
```

## Алгоритмы гарантии доставки и корректности получения

* Каждый запрос маркируется:
  * рандомным уникальным токеном
  * id отправителя
  * id получателя, либо null, если broadcast

* Подтверждение получения сообщения происходит, если отправитель сообщения с токеном получает кадр подтверждения сообщения для письма с этим токеном

#### Алгоритм передачи сообщения по кольцу

* Получено сообщение
  * Информационное сообщение
    * **Сообщение бродкастом**:
      * Я - отправитель: прекратить дальнейшую передачу
      * Иначе: обработать и транслировать далее
    * **Не бродкаст, Я - получатель**: обработать сообщение и отправить далее сообщение подтверждения получения
    * **Не бродкаст, Я - отправитель**: значит, никто его не обработал. Логика ошибки доставки сообщения, прекратить дальнейшую передачу
    * **Иначе**: транслировать

  * Сообщение подтверждения получения
    * **Я - отправитель информационного сообщения**: логика подтверждения получения, прекратить дальнейшую передачу сообщения
    * **Я - отправитель сообщения подтверждения получения**: логика ошибки доставки сообщения, прекратить дальнейшую передачу
    * **Иначе**: транслировать

* Передано сообщение
  * Информационное сообщение
    * **Прошел таймаут и не пришло сообщение с этим токеном**: логика ошибки отправки сообщения
